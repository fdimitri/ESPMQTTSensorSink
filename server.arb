require 'rubygems'
require 'solargraph'
require 'em/mqtt'
require 'awesome_print'
require 'yaml'

EventMachine::error_handler { |e| puts "#{e}: #{e.backtrace.first}" }


def messageCallback(msg)
    #MQTT::Packet::Publish
    #bool flags[4]
    #topic
    #body_length
    #payload
end

EventMachine.run do
    EventMachine::MQTT::ClientConnection.connect(
    :host => '192.168.0.133',
    :username => 'emqx',
    :password => 'public'
  ) do |c|
    c.subscribe('#')
    c.receive_callback do |message|
      h = { :topic => message.topic, :msg => message.payload }
      ap h
    end
  end
end

